# Minimalistic PageXML Viewer — Metadata Documentation generated by AI

This document describes the metadata files used by the viewer: the top-level `manuscripts.json` (list of manuscripts) and per-manuscript metadata in one of three supported formats: `mets.xml`, `mets.json`, or `mets.csv`.

---

## manuscripts.json

**Purpose**: Defines the list of available manuscripts displayed in the viewer's Manuscripts tab.

**Location**: Root of the project (same directory as `index.html`).

**Format**: JSON array of manuscript objects.

**Required fields**:
- `manuscriptFolder` (string): Name of the folder containing the manuscript's images and metadata. This folder should be located in the project root and contain a `mets.xml`, `mets.json`, or `mets.csv` file.

**Optional fields**:
- `title` (string): Display title for the manuscript
- `sourceUrl` (string): URL to the original source or repository
- `description` (string): Brief description shown in the manuscript card

**Example**:

```json
[
  {
    "manuscriptFolder": "Chronicle_of_Dalimil",
    "title": "Chronicle of Dalimil - NKP XII E 17",
    "sourceUrl": "",
    "description": "Latin fragment of the Chronicle of Dalimil."
  },
  {
    "manuscriptFolder": "Cosmas_of_Prague_-_A3a_-_ÖNB_508_-_Winter_School",
    "title": "Cosmas of Prague - ÖNB 508",
    "sourceUrl": "https://viewer.onb.ac.at/13227113/12",
    "description": "Cosmas of Prague was a medieval chronicler..."
  }
]
```

---

## Per-Manuscript Metadata

Each manuscript folder must contain **one** of the following metadata files (tried in this order):

### 1. mets.xml (METS format - preferred)

**Purpose**: Standard METS file exported from Transkribus or similar platforms.

**Location**: `{manuscriptFolder}/mets.xml`

**Structure requirements**:

The viewer expects:
- A `<fileSec>` section containing file groups with:
  - `<file>` elements with `ID` and `MIMETYPE` attributes
  - `<FLocat>` child elements with `href` or `xlink:href` attributes pointing to image (.jpg) and PageXML (.xml) files
- A `<structMap>` section with:
  - Page divisions having `ORDER` attributes (defines page sequence)
  - `<area>` or similar elements with `FILEID` attributes linking to files from `fileSec`

**File path handling**:
- Image files (JPEG/PNG): should be directly in the manuscript folder or a subfolder
- PageXML files: typically in a `page/` subfolder
- All paths in `href` are relative to the manuscript folder

**Example structure** (simplified from actual Transkribus export):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ns3:mets xmlns:ns2="http://www.w3.org/1999/xlink" 
          xmlns:ns3="http://www.loc.gov/METS/">
    <ns3:fileSec>
        <ns3:fileGrp ID="MASTER">
            <ns3:fileGrp ID="IMG">
                <ns3:file ID="IMG_3" SEQ="3" MIMETYPE="image/jpeg">
                    <ns3:FLocat ns2:href="p003.jpg"/>
                </ns3:file>
                <ns3:file ID="IMG_5" SEQ="5" MIMETYPE="image/jpeg">
                    <ns3:FLocat ns2:href="p005.jpg"/>
                </ns3:file>
            </ns3:fileGrp>
            <ns3:fileGrp ID="PAGEXML">
                <ns3:file ID="PAGEXML_3" SEQ="3" MIMETYPE="application/xml">
                    <ns3:FLocat ns2:href="page/p003.xml"/>
                </ns3:file>
                <ns3:file ID="PAGEXML_5" SEQ="5" MIMETYPE="application/xml">
                    <ns3:FLocat ns2:href="page/p005.xml"/>
                </ns3:file>
            </ns3:fileGrp>
        </ns3:fileGrp>
    </ns3:fileSec>
    <ns3:structMap TYPE="PHYSICAL">
        <ns3:div TYPE="physSequence">
            <ns3:div TYPE="page" ORDER="1">
                <ns3:fptr>
                    <ns3:area FILEID="IMG_3"/>
                    <ns3:area FILEID="PAGEXML_3"/>
                </ns3:fptr>
            </ns3:div>
            <ns3:div TYPE="page" ORDER="2">
                <ns3:fptr>
                    <ns3:area FILEID="IMG_5"/>
                    <ns3:area FILEID="PAGEXML_5"/>
                </ns3:fptr>
            </ns3:div>
        </ns3:div>
    </ns3:structMap>
</ns3:mets>
```

**Parser behavior**:
1. Builds a map of file IDs → hrefs from all `<file>` elements
2. Finds all elements with `ORDER` attribute in `structMap`
3. For each page, collects `FILEID` references and matches them against the file map
4. Separates files by extension: `.jpg/.png` = image, `.xml` = PageXML
5. Creates pages sorted by `ORDER` value

---

### 2. mets.json (Simple JSON fallback)

**Purpose**: Simplified alternative when METS XML is not available or too complex.

**Location**: `{manuscriptFolder}/mets.json`

**Format**: JSON array where each object represents one page.

**Required fields per page**:
- `image` (string): Path to the image file, relative to manuscript folder
- `pagexml` (string): Path to the PageXML file, relative to manuscript folder

**Example**:

```json
[
  { "image": "p003.jpg", "pagexml": "page/p003.xml" },
  { "image": "p005.jpg", "pagexml": "page/p005.xml" },
  { "image": "p011.jpg", "pagexml": "page/p011.xml" }
]
```

---

### 3. mets.csv (Minimal CSV fallback)

**Purpose**: Simplest possible format for quick prototyping or minimal datasets.

**Location**: `{manuscriptFolder}/mets.csv`

**Format**: CSV with two columns (optional header row).

**Columns**:
1. Image file path (relative to manuscript folder)
2. PageXML file path (relative to manuscript folder)

**Header detection**: If the first row contains any of these keywords (case-insensitive): `image`, `page`, `pagexml`, `path`, it will be treated as a header and skipped.

**CSV parsing features**:
- Supports both single and double quotes
- Handles commas inside quoted fields
- Handles escaped quotes (doubled quotes: `""` or `''`)

**Example with header**:

```csv
image,pagexml
p003.jpg,page/p003.xml
p005.jpg,page/p005.xml
p011.jpg,page/p011.xml
```

**Example without header**:

```csv
p003.jpg,page/p003.xml
p005.jpg,page/p005.xml
p011.jpg,page/p011.xml
```

**Example with quoted fields**:

```csv
image,pagexml
"images/page 001.jpg","page/p001.xml"
"images/page,with,commas.jpg","page/p002.xml"
```

---

## Manuscript Folder Structure

Typical structure for a manuscript:

```
Chronicle_of_Dalimil/
├── mets.xml              # Metadata (METS format)
├── metadata.xml          # Optional additional metadata
├── p003.jpg              # Page images
├── p005.jpg
├── p011.jpg
└── page/                 # PageXML files subfolder
    ├── p003.xml
    ├── p005.xml
    └── p011.xml
```

Or with JSON fallback:

```
MyManuscript/
├── mets.json            # Metadata (JSON format)
├── images/              # Images in subfolder
│   ├── page001.jpg
│   └── page002.jpg
└── page/                # PageXML files
    ├── page001.xml
    └── page002.xml
```

---

## Path Resolution

All file paths are resolved **relative to the manuscript folder**:
- If `manuscriptFolder` is `"Chronicle_of_Dalimil"`
- And the image path is `"p003.jpg"`
- The viewer will fetch: `Chronicle_of_Dalimil/p003.jpg`

The viewer handles URL encoding automatically for special characters.

---

## Troubleshooting

**Pages not loading:**
1. Open browser console (F12) to see which metadata format was tried
2. Check that file paths in metadata match actual file locations
3. Verify manuscript folder name matches `manuscriptFolder` in `manuscripts.json`

**Console messages:**
- `"mets.xml not found, trying mets.json fallback..."` — normal fallback behavior
- `"mets.json not found, trying mets.csv..."` — normal fallback behavior
- `"Neither mets.xml, mets.json nor mets.csv found"` — no metadata file exists
- `"Loaded X pages from mets.xml/json/csv"` — success message

**Common issues:**
- Wrong file paths: ensure paths are relative to manuscript folder
- Case sensitivity: some servers are case-sensitive (use exact filename case)
- Missing files: verify all referenced images and XML files exist
- CSV parsing: ensure no unescaped quotes or malformed rows
